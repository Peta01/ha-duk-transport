# Lovelace Dashboard - OdjezdovÃ¡ tabule DUK
# PÅ™idejte tento obsah do vaÅ¡eho Lovelace dashboard

title: OdjezdovÃ¡ tabule - Doprava ÃšsteckÃ©ho kraje
views:
  - title: Odjezdy
    icon: mdi:bus-clock
    cards:
      # HlavnÃ­ odjezdovÃ¡ tabule
      - type: vertical-stack
        cards:
          # Header s nÃ¡zvem zastÃ¡vky
          - type: markdown
            content: |
              # ğŸšŒ OdjezdovÃ¡ tabule
              **{{ state_attr('sensor.duk_transport_zastÃ¡vka_12345', 'stop_name') or 'ZastÃ¡vka DUK' }}**
              
              *AktualizovÃ¡no: {{ as_timestamp(states.sensor.duk_transport_zastÃ¡vka_12345.last_updated) | timestamp_custom('%H:%M:%S') }}*

          # AktuÃ¡lnÃ­ stav
          - type: entities
            show_header_toggle: false
            entities:
              - entity: sensor.duk_transport_zastÃ¡vka_12345
                name: "AktuÃ¡lnÃ­ stav"
                icon: mdi:bus-clock
              - entity: sensor.duk_transport_next_departure
                name: "DalÅ¡Ã­ odjezd"
                icon: mdi:clock-outline

          # Tabulka s odjezdy
          - type: custom:auto-entities
            card:
              type: entities
              title: "ğŸ“‹ AktuÃ¡lnÃ­ odjezdy"
              show_header_toggle: false
            filter:
              template: |
                {% set departures = state_attr('sensor.duk_transport_zastÃ¡vka_12345', 'departures') or [] %}
                {% set entities = [] %}
                {% for departure in departures[:10] %}
                  {% set delay_icon = 'mdi:clock-alert' if departure.delay > 0 else 'mdi:clock-check' %}
                  {% set delay_text = '+' + departure.delay|string + ' min' if departure.delay > 0 else 'naÄas' %}
                  {% set entities = entities + [{
                    'entity': 'sensor.duk_transport_zastÃ¡vka_12345',
                    'name': departure.line + ' â†’ ' + departure.destination,
                    'secondary_info': departure.departure_time + ' (' + delay_text + ')',
                    'icon': delay_icon
                  }] %}
                {% endfor %}
                {{ entities }}

      # Statistiky a informace
      - type: horizontal-stack
        cards:
          - type: statistic
            entity: sensor.duk_transport_zastÃ¡vka_12345
            name: "Celkem odjezdÅ¯"
            stat_type: state
            
          - type: gauge
            entity: sensor.duk_transport_next_departure
            name: "DalÅ¡Ã­ odjezd za"
            min: 0
            max: 60
            severity:
              green: 10
              yellow: 5
              red: 0

      # NastavenÃ­ a ovlÃ¡dÃ¡nÃ­
      - type: vertical-stack
        title: "âš™ï¸ NastavenÃ­"
        cards:
          - type: entities
            entities:
              - entity: input_text.duk_stop_id
                name: "ID zastÃ¡vky"
              - entity: input_number.duk_max_departures
                name: "PoÄet odjezdÅ¯"
              - entity: input_number.duk_update_interval
                name: "Interval aktualizace"
              
          - type: button
            name: "Aktualizovat data"
            tap_action:
              action: call-service
              service: homeassistant.update_entity
              target:
                entity_id: sensor.duk_transport_zastÃ¡vka_12345

  # DruhÃ¡ strÃ¡nka - detailnÃ­ informace
  - title: Detail
    icon: mdi:information-outline
    cards:
      - type: markdown
        content: |
          ## ğŸ“Š DetailnÃ­ informace o odjezdech
          
          ### AktuÃ¡lnÃ­ data:
          - **ZastÃ¡vka:** {{ state_attr('sensor.duk_transport_zastÃ¡vka_12345', 'stop_name') }}
          - **ID zastÃ¡vky:** {{ state_attr('sensor.duk_transport_zastÃ¡vka_12345', 'stop_id') }}
          - **PoÄet odjezdÅ¯:** {{ state_attr('sensor.duk_transport_zastÃ¡vka_12345', 'count') }}
          - **PoslednÃ­ aktualizace:** {{ as_timestamp(states.sensor.duk_transport_zastÃ¡vka_12345.last_updated) | timestamp_custom('%d.%m.%Y %H:%M:%S') }}

      # Raw data pro debugging
      - type: entities
        title: "ğŸ”§ TechnickÃ© informace"
        entities:
          - entity: sensor.duk_transport_zastÃ¡vka_12345
            attribute: departures
            name: "Raw data odjezdÅ¯"